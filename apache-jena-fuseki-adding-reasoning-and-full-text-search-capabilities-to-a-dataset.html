<!doctype html>
<html lang="en" prefix="og: http://ogp.me/ns#">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Apache Jena Fuseki - Adding reasoning and full-text search capabilities to a dataset | APOTHEM
</title>
  <link rel="canonical" href="https://apothem.blog/apache-jena-fuseki-adding-reasoning-and-full-text-search-capabilities-to-a-dataset.html">

    <link rel="icon" type="image/x-icon" href="https://apothem.blog/favicon.ico">

  <link rel="stylesheet" href="https://apothem.blog/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://apothem.blog/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://apothem.blog/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://apothem.blog/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://apothem.blog/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://apothem.blog/feeds/{slug}.atom.xml">  
  <meta name="description" content="With this article I am kicking off a new series called howto where, instead of describing a whole Apache project, I will explore use cases, problems and solutions related to one. I will start with Apache Jena Fuseki looking into how to enable both reasoning and full-text search on a …">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="https://apothem.blog/">
        <img class="img-fluid rounded" src=https://apothem.blog/images/profile.svg width=180 alt="APOTHEM">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="https://apothem.blog/">APOTHEM</a></h1>
      <p class="text-muted">Apache Project(s) of the month</p>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="https://projects.apache.org" target="_blank">projects.apache.org</a></li>
              <li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a href="https://apothem.blog/pages/about.html">About</a></li>
            <li class="list-inline-item"><a href="https://apothem.blog/pages/faq.html">FAQ</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fa fa-github" href="https://github.com/nvitucci/apothem" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fa fa-twitter" href="https://twitter.com/nvitucci" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fa fa-rss" href="feeds/all.atom.xml" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h2>  Apache Jena Fuseki - Adding reasoning and full-text search capabilities to a dataset
</h2>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2020-04-30T00:00:00+01:00">
          <i class="fa fa-clock-o"></i>
          Thu 30 April 2020
        </li>
        <li class="list-inline-item">
          <i class="fa fa-folder-open-o"></i>
          <a href="https://apothem.blog/category/howto.html">howto</a>
        </li>
          <li class="list-inline-item">
            <i class="fa fa-files-o"></i>
              <a href="https://apothem.blog/tag/semantic-web.html">#Semantic Web</a>,               <a href="https://apothem.blog/tag/full-text-search.html">#full-text search</a>,               <a href="https://apothem.blog/tag/reasoning.html">#reasoning</a>,               <a href="https://apothem.blog/tag/inferencing.html">#inferencing</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>With this article I am kicking off a new series called <strong><a href="/category/howto.html">howto</a></strong> where, instead of describing a whole Apache project, I will explore use cases, problems and solutions related to one. I will start with <a href="https://jena.apache.org/documentation/fuseki2/">Apache Jena Fuseki</a> looking into how to enable both reasoning and full-text search on a given dataset, which took me some time to figure out as the documentation is a bit lacking on the topic. As usual, I will put the relevant files and examples in the <a href="https://github.com/nvitucci/apothem-resources/tree/master/howto/apache-jena-fuseki/reasoning_and_fts/">Apothem resources repository</a>.</p>
<div class="toc"><span class="toctitle">Index:</span><ul>
<li><a href="#setup">Setup</a><ul>
<li><a href="#downloading-and-running-fuseki">Downloading and running Fuseki</a></li>
<li><a href="#creating-a-dataset">Creating a dataset</a></li>
<li><a href="#loading-some-data">Loading some data</a></li>
</ul>
</li>
<li><a href="#adding-a-reasoner">Adding a reasoner</a><ul>
<li><a href="#scenario-1-no-named-graphs">Scenario 1: no named graphs</a></li>
<li><a href="#scenario-2-named-graphs-and-no-online-updates">Scenario 2: named graphs and no online updates</a></li>
<li><a href="#scenario-3-named-graphs-and-online-updates">Scenario 3: named graphs and online updates</a><ul>
<li><a href="#one-named-graph">One named graph</a></li>
<li><a href="#many-named-graphs">Many named graphs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#adding-full-text-search">Adding full-text search</a></li>
<li><a href="#conclusions">Conclusions</a></li>
<li><a href="#acknowledgements">Acknowledgements</a></li>
</ul>
</div>
<h3 id="setup">Setup</h3>
<h4 id="downloading-and-running-fuseki">Downloading and running Fuseki</h4>
<p>First of all, let's download Fuseki from the <a href="https://jena.apache.org/download/">Jena download page</a> (at the time of writing, the latest version is the 3.14.0). There are <a href="https://jena.apache.org/documentation/fuseki2/fuseki-run.html">different ways</a> to run Fuseki, although my preference is to use it as a Web application by deploying it to Tomcat.</p>
<h4 id="creating-a-dataset">Creating a dataset</h4>
<p>Once up and running, let's create a persistent TDB2 dataset called <code>example-inf</code>; in my case (Linux) the dataset will be created in <code>/etc/fuseki/databases/example-inf</code> and its configuration file will be stored as <code>/etc/fuseki/configuration/example-inf.ttl</code>.</p>
<p>Creating a dataset is very easy using the Web UI, but nothing besides the storage (in memory, TDB or TDB2) can be configured. One can also create a dataset using the <a href="https://jena.apache.org/documentation/fuseki2/fuseki-server-protocol.html">HTTP admin protocol</a> and passing the database type and the dataset name as parameters:</p>
<div class="highlight"><pre><span></span>$ curl -X POST <span class="s1">&#39;http://localhost:8080/fuseki/$/datasets&#39;</span> --data <span class="s1">&#39;dbType=tdb2&#39;</span> --data <span class="s1">&#39;dbName=example-inf&#39;</span>
</pre></div>


<p>Assuming to have the configuration specified as a Turtle file (which we skip for now), the HTTP interface makes it even possible to create a dataset as follows:</p>
<div class="highlight"><pre><span></span>$ curl -X POST <span class="s1">&#39;http://localhost:8080/fuseki/$/datasets&#39;</span> --upload-file /tmp/example-inf.ttl --header <span class="s2">&quot;Content-Type: text/turtle&quot;</span>
</pre></div>


<h4 id="loading-some-data">Loading some data</h4>
<p>In the scenario I am interested in, the reasoner should support at least <code>rdfs:subClassOf</code>, <code>rdfs:subPropertyOf</code>, <code>rdf:type</code>, and <code>owl:sameAs</code>. A minimal <code>data1.ttl</code> document that we can use for testing may be:</p>
<div class="highlight"><pre><span></span><span class="k">@prefix</span><span class="w"> </span><span class="nn">rdf:</span><span class="w">  </span><span class="nv">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">rdfs:</span><span class="w"> </span><span class="nv">&lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">owl:</span><span class="w">  </span><span class="nv">&lt;http://www.w3.org/2002/07/owl#&gt;</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">id:</span><span class="w">   </span><span class="nv">&lt;http://www.example.org/id/&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">ont:</span><span class="w">  </span><span class="nv">&lt;http://www.example.org/ont#&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">ont:</span><span class="nt">MyType</span><span class="w"> </span><span class="nn">rdfs:</span><span class="nt">subClassOf</span><span class="w"> </span><span class="nn">ont:</span><span class="nt">MySuperType</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="nn">ont:</span><span class="nt">myProp</span><span class="w"> </span><span class="nn">rdfs:</span><span class="nt">subPropertyOf</span><span class="w"> </span><span class="nn">ont:</span><span class="nt">mySuperProp</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="nn">id:</span><span class="nt">a</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w"> </span><span class="nn">ont:</span><span class="nt">MyType</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="nn">id:</span><span class="nt">a</span><span class="w"> </span><span class="nn">ont:</span><span class="nt">myProp</span><span class="w"> </span><span class="nn">id:</span><span class="nt">x</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="nn">id:</span><span class="nt">b</span><span class="w"> </span><span class="nn">owl:</span><span class="nt">sameAs</span><span class="w"> </span><span class="nn">id:</span><span class="nt">a</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
</pre></div>


<p>Let's load it on the <code>example-inf</code> dataset and run a simple <em>SPO</em> query (with an <code>ORDER BY</code> for visualization convenience):</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">WHERE</span> <span class="p">{</span>
  <span class="nv">?s</span> <span class="nv">?p</span> <span class="nv">?o</span> <span class="p">.</span>
<span class="p">}</span>
<span class="k">ORDER BY</span> <span class="nv">?p</span> <span class="nv">?o</span>
</pre></div>


<p>As a result we should see all and only the 5 triples, while the following query with <code>id:a</code> as a subject should only return the triples <code>id:a rdf:type ont:MyType</code> and <code>id:a ont:myProp id:x</code> :</p>
<div class="highlight"><pre><span></span><span class="k">PREFIX</span> <span class="nn">id</span><span class="p">:</span> <span class="nl">&lt;http://www.example.org/id/&gt;</span>

<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">WHERE</span> <span class="p">{</span>
  <span class="nn">id</span><span class="p">:</span><span class="nt">a</span> <span class="nv">?p</span> <span class="nv">?o</span> <span class="p">.</span>
<span class="p">}</span>
</pre></div>


<p>In the following, I will refer to these two queries as <em>SPO</em> and <em>id:a</em> respectively.</p>
<h3 id="adding-a-reasoner">Adding a reasoner</h3>
<p>The reasoners that Fuseki can directly use are forward/backward rule-based reasoners, subclasses of <a href="https://jena.apache.org/documentation/javadoc/jena/org/apache/jena/reasoner/rulesys/FBRuleReasoner.html">FBRuleReasoner</a> based on this hierarchy:</p>
<div class="highlight"><pre><span></span>FBRuleReasoner
├── GenericRuleReasoner
│   ├── OWLMicroReasoner
│   ├── OWLMiniReasoner
│   └── RDFSRuleReasoner
├── OWLFBRuleReasoner
└── TransitiveReasoner
</pre></div>


<p>Each reasoner class has an associated URI (found in its corresponding <code>Factory</code> class) which we need to know as it will be used in the dataset configuration file:</p>
<div class="highlight"><pre><span></span>GenericRuleReasoner -&gt; &lt;http://jena.hpl.hp.com/2003/GenericRuleReasoner&gt;
OWLMicroReasoner    -&gt; &lt;http://jena.hpl.hp.com/2003/OWLMicroFBRuleReasoner&gt;
OWLMiniReasoner     -&gt; &lt;http://jena.hpl.hp.com/2003/OWLMiniFBRuleReasoner&gt;
RDFSRuleReasoner    -&gt; &lt;http://jena.hpl.hp.com/2003/RDFSExptRuleReasoner&gt;
OWLFBRuleReasoner   -&gt; &lt;http://jena.hpl.hp.com/2003/OWLFBRuleReasoner&gt;
TransitiveReasoner  -&gt; &lt;http://jena.hpl.hp.com/2003/TransitiveReasoner&gt;
</pre></div>


<p>The first thing to evaluate when choosing a reasoner is the desired level of inference, taking into account that the higher the level, the longer the reasoner will take to produce all the inferred triples; <a href="https://jena.apache.org/documentation/inference/index.html">Jena documentation</a> provides a good description of each reasoner, and <a href="https://www.slideshare.net/nvitucci/semantic-web-languages-expressivity-vs-scalability">my (old) presentation</a> discusses the balance between expressivity and scalability. For our (small) tests, anyway, we will use the "rich" <code>OWLFBRuleReasoner</code>, taking into account that any of the other reasoners can be used by simply replacing its URL (and, in the case of the <code>GenericRuleReasoner</code>, by adding a <code>ja:rulesFrom &lt;rulefile&gt;</code> triple) in the configuration file.</p>
<h4 id="scenario-1-no-named-graphs">Scenario 1: no named graphs</h4>
<p>We'll start with the case where we do not need to use named graphs and all the triples are added to the default graph.</p>
<p>Let's check the dataset configuration file that has been created in <code>/etc/fuseki/configuration/example-inf.ttl</code>. It will contain quite a number of triples, but the relevant section for us is the following:</p>
<div class="highlight"><pre><span></span><span class="nn">:</span><span class="nt">service_tdb_all</span><span class="w">  </span><span class="kt">a</span><span class="w">               </span><span class="nn">fuseki:</span><span class="nt">Service</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">rdfs:</span><span class="nt">label</span><span class="w">                    </span><span class="s">&quot;TDB2 example-inf&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">fuseki:</span><span class="nt">dataset</span><span class="w">                </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">fuseki:</span><span class="nt">name</span><span class="w">                   </span><span class="s">&quot;example-inf&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">fuseki:</span><span class="nt">serviceQuery</span><span class="w">           </span><span class="s">&quot;query&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sparql&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">fuseki:</span><span class="nt">serviceReadGraphStore</span><span class="w">  </span><span class="s">&quot;get&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">fuseki:</span><span class="nt">serviceReadQuads</span><span class="w">       </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">fuseki:</span><span class="nt">serviceReadWriteGraphStore</span><span class="w"> </span><span class="s">&quot;data&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">fuseki:</span><span class="nt">serviceReadWriteQuads</span><span class="w">  </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">fuseki:</span><span class="nt">serviceUpdate</span><span class="w">          </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s">&quot;update&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">fuseki:</span><span class="nt">serviceUpload</span><span class="w">          </span><span class="s">&quot;upload&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"></span>
<span class="w">    </span><span class="kt">a</span><span class="w">              </span><span class="nn">tdb2:</span><span class="nt">DatasetTDB2</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">tdb2:</span><span class="nt">location</span><span class="w">  </span><span class="s">&quot;/etc/fuseki/databases/example-inf&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="w"></span>
</pre></div>


<p>All we need to do is to add the following triples at the end of the file:</p>
<div class="highlight"><pre><span></span><span class="nn">:</span><span class="nt">dataset</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">ja:</span><span class="nt">RDFDataset</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">ja:</span><span class="nt">defaultGraph</span><span class="w"> </span><span class="nn">:</span><span class="nt">model_inf</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">model_inf</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">ja:</span><span class="nt">InfModel</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="nn">ja:</span><span class="nt">baseModel</span><span class="w"> </span><span class="nn">:</span><span class="nt">graph</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="nn">ja:</span><span class="nt">reasoner</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">         </span><span class="nn">ja:</span><span class="nt">reasonerURL</span><span class="w"> </span><span class="nv">&lt;http://jena.hpl.hp.com/2003/OWLFBRuleReasoner&gt;</span><span class="w"></span>
<span class="w">     </span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">graph</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w"> </span><span class="nn">tdb2:</span><span class="nt">GraphTDB</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="w"></span>
</pre></div>


<p>and replace this line:</p>
<div class="highlight"><pre><span></span><span class="nn">fuseki:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>with the following:</p>
<div class="highlight"><pre><span></span><span class="nn">fuseki:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">dataset</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>and then we need to restart Fuseki. (To avoid restarting Fuseki, the alternative would be to produce the configuration file first and then to add the new dataset via the HTTP interface.)</p>
<p>Now, if we run the <em>SPO</em> query, we get a whole lot of triples including the ones related to the OWL schema; the <em>id:a</em> query, instead, will return the five base triples plus the inferred triples:</p>
<div class="highlight"><pre><span></span>ont:myProp id:x
ont:mySuperProp id:x
rdf:type ont:MySuperType
rdf:type ont:MyType
rdf:type rdfs:Resource
rdf:type owl:Thing
owl:sameAs id:a
owl:sameAs id:b
</pre></div>


<p>What happens if we add some new triples? Let's create a <code>data2.ttl</code> file with the following content:</p>
<div class="highlight"><pre><span></span><span class="k">@prefix</span><span class="w"> </span><span class="nn">rdf:</span><span class="w">  </span><span class="nv">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">rdfs:</span><span class="w"> </span><span class="nv">&lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">owl:</span><span class="w">  </span><span class="nv">&lt;http://www.w3.org/2002/07/owl#&gt;</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">id:</span><span class="w">   </span><span class="nv">&lt;http://www.example.org/id/&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">ont:</span><span class="w">  </span><span class="nv">&lt;http://www.example.org/ont#&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">ont:</span><span class="nt">MySubType</span><span class="w"> </span><span class="nn">rdfs:</span><span class="nt">subClassOf</span><span class="w"> </span><span class="nn">ont:</span><span class="nt">MyType</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="nn">id:</span><span class="nt">d</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w"> </span><span class="nn">ont:</span><span class="nt">MySubType</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="nn">id:</span><span class="nt">d</span><span class="w"> </span><span class="nn">owl:</span><span class="nt">sameAs</span><span class="w"> </span><span class="nn">id:</span><span class="nt">a</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
</pre></div>


<p>and load it. Now the <em>id:a</em> query returns two more triples:</p>
<div class="highlight"><pre><span></span>rdf:type ont:MySubType
owl:sameAs id:d
</pre></div>


<p>Reasoning works fine! So let's make it even more interesting: what if we want to put our triples in a named graph?</p>
<h4 id="scenario-2-named-graphs-and-no-online-updates">Scenario 2: named graphs and no online updates</h4>
<p>If we don't need online updates (i.e. to have the reasoner run as soon as new triples are inserted), but we are fine with restarting the server for the reasoner to catch up, all we need is to add one triple to the <code>:graph</code> section of the previous configuration:</p>
<div class="highlight"><pre><span></span><span class="nn">:</span><span class="nt">graph</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w"> </span><span class="nn">tdb2:</span><span class="nt">GraphTDB</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="hll"><span class="w">  </span><span class="nn">tdb2:</span><span class="nt">graphName</span><span class="w"> </span><span class="nv">&lt;urn:x-arq:UnionGraph&gt;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
</span><span class="w">  </span><span class="p">.</span><span class="w"></span>
</pre></div>


<p>The triple uses the special <code>&lt;urn:x-arq:UnionGraph&gt;</code> (as described <a href="https://jena.apache.org/documentation/tdb/datasets.html">here</a>) to perform reasoning on <em>all</em> the graphs. Optionally, if we want to be able to query all the named graphs without having to use the <code>FROM</code> construct, we can slightly modify the <code>:tdb_dataset_readwrite</code> section adding another triple:</p>
<div class="highlight"><pre><span></span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"></span>
<span class="w">    </span><span class="kt">a</span><span class="w">              </span><span class="nn">tdb2:</span><span class="nt">DatasetTDB2</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">tdb2:</span><span class="nt">location</span><span class="w">  </span><span class="s">&quot;/etc/fuseki/databases/example-inf&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="hll"><span class="w">    </span><span class="nn">tdb2:</span><span class="nt">unionDefaultGraph</span><span class="w"> </span><span class="l">true</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
</span><span class="w">    </span><span class="p">.</span><span class="w"></span>
</pre></div>


<p>We need to keep in mind, though, that this will hide the "real" default graph replacing it with the "virtual" special union graph.</p>
<h4 id="scenario-3-named-graphs-and-online-updates">Scenario 3: named graphs and online updates</h4>
<p>When using named graph, online updates will only be supported on a per-graph basis. This means that adding triples to a named graph does not "refresh" its corresponding inference model; the reasoner will be triggered only by the addition and deletion of triples to the model itself, but this change will be persisted in the underlying named graph as well.</p>
<h5 id="one-named-graph">One named graph</h5>
<p>If we have only one named graph and we are fine with the inferenced triples be inserted in the default graph, the configuration is still pretty easy in that we only need to add the following triples:</p>
<div class="highlight"><pre><span></span><span class="nn">:</span><span class="nt">dataset</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">ja:</span><span class="nt">RDFDataset</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">ja:</span><span class="nt">defaultGraph</span><span class="w"> </span><span class="nn">:</span><span class="nt">model_inf</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">ja:</span><span class="nt">namedGraph</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="nn">ja:</span><span class="nt">graph</span><span class="w">        </span><span class="nn">:</span><span class="nt">mygraph</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="nn">ja:</span><span class="nt">graphName</span><span class="w">    </span><span class="nv">&lt;http://www.example.org/id/mygraph&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">mygraph</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w"> </span><span class="nn">tdb2:</span><span class="nt">GraphTDB</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">graphName</span><span class="w"> </span><span class="nv">&lt;http://www.example.org/id/mygraph&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">model_inf</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">ja:</span><span class="nt">InfModel</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="nn">ja:</span><span class="nt">baseModel</span><span class="w"> </span><span class="nn">:</span><span class="nt">graph</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="nn">ja:</span><span class="nt">reasoner</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">         </span><span class="nn">ja:</span><span class="nt">reasonerURL</span><span class="w"> </span><span class="nv">&lt;http://jena.hpl.hp.com/2003/OWLFBRuleReasoner&gt;</span><span class="w"></span>
<span class="w">     </span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">graph</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w"> </span><span class="nn">tdb2:</span><span class="nt">GraphTDB</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">graphName</span><span class="w"> </span><span class="nv">&lt;http://www.example.org/id/mygraph&gt;</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="w"></span>
</pre></div>


<p>and, again, replace this line:</p>
<div class="highlight"><pre><span></span><span class="nn">fuseki:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>with the following:</p>
<div class="highlight"><pre><span></span><span class="nn">fuseki:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">dataset</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>Basically, the example <code>&lt;http://www.example.org/id/mygraph&gt;</code> named graph has to be added explicitly both to the <code>:dataset</code> (via <code>ja:namedGraph</code>) and to the <code>:graph</code> underlying the <code>:model_inf</code> (via <code>tdb2:graphName</code>); this will let us query both the original named graph and the inferred model, and updates to the default graph will be reflected in the named graph.</p>
<h5 id="many-named-graphs">Many named graphs</h5>
<p>If we have more than one named graph and we want to support cross-graph inference, things get more complicated. One possible solution is to have each named graph be wrapped by a model (updated in real time) and the default graph be the union of <em>all</em> the graphs (updated upon server restart).</p>
<div class="highlight"><pre><span></span><span class="nn">:</span><span class="nt">dataset</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">ja:</span><span class="nt">RDFDataset</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">ja:</span><span class="nt">defaultGraph</span><span class="w"> </span><span class="nn">:</span><span class="nt">model_inf</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">ja:</span><span class="nt">namedGraph</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="nn">ja:</span><span class="nt">graph</span><span class="w">        </span><span class="nn">:</span><span class="nt">mygraph</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="nn">ja:</span><span class="nt">graphName</span><span class="w">    </span><span class="nv">&lt;http://www.example.org/id/mygraph&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">ja:</span><span class="nt">namedGraph</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="nn">ja:</span><span class="nt">graph</span><span class="w">        </span><span class="nn">:</span><span class="nt">mygraph2</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="nn">ja:</span><span class="nt">graphName</span><span class="w">    </span><span class="nv">&lt;http://www.example.org/id/mygraph2&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">ja:</span><span class="nt">namedGraph</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="nn">ja:</span><span class="nt">graph</span><span class="w">        </span><span class="nn">:</span><span class="nt">inf</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="nn">ja:</span><span class="nt">graphName</span><span class="w">    </span><span class="nv">&lt;http://www.example.org/id/inf&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">ja:</span><span class="nt">namedGraph</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">        </span><span class="nn">ja:</span><span class="nt">graph</span><span class="w">        </span><span class="nn">:</span><span class="nt">inf2</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="nn">ja:</span><span class="nt">graphName</span><span class="w">    </span><span class="nv">&lt;http://www.example.org/id/inf2&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">mygraph</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w"> </span><span class="nn">tdb2:</span><span class="nt">GraphTDB</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">graphName</span><span class="w"> </span><span class="nv">&lt;http://www.example.org/id/mygraph&gt;</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">mygraph2</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w"> </span><span class="nn">tdb2:</span><span class="nt">GraphTDB</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">graphName</span><span class="w"> </span><span class="nv">&lt;http://www.example.org/id/mygraph2&gt;</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">inf</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">ja:</span><span class="nt">InfModel</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="nn">ja:</span><span class="nt">baseModel</span><span class="w"> </span><span class="nn">:</span><span class="nt">graph</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="nn">ja:</span><span class="nt">reasoner</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">         </span><span class="nn">ja:</span><span class="nt">reasonerURL</span><span class="w"> </span><span class="nv">&lt;http://jena.hpl.hp.com/2003/OWLFBRuleReasoner&gt;</span><span class="w"></span>
<span class="w">     </span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">inf2</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">ja:</span><span class="nt">InfModel</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="nn">ja:</span><span class="nt">baseModel</span><span class="w"> </span><span class="nn">:</span><span class="nt">graph2</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="nn">ja:</span><span class="nt">reasoner</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">         </span><span class="nn">ja:</span><span class="nt">reasonerURL</span><span class="w"> </span><span class="nv">&lt;http://jena.hpl.hp.com/2003/OWLFBRuleReasoner&gt;</span><span class="w"></span>
<span class="w">     </span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">graph</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w"> </span><span class="nn">tdb2:</span><span class="nt">GraphTDB</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">graphName</span><span class="w"> </span><span class="nv">&lt;http://www.example.org/id/mygraph&gt;</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">graph2</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w"> </span><span class="nn">tdb2:</span><span class="nt">GraphTDB</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">graphName</span><span class="w"> </span><span class="nv">&lt;http://www.example.org/id/mygraph2&gt;</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">model_inf</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">ja:</span><span class="nt">InfModel</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="nn">ja:</span><span class="nt">baseModel</span><span class="w"> </span><span class="nn">:</span><span class="nt">union_graph</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="nn">ja:</span><span class="nt">reasoner</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">         </span><span class="nn">ja:</span><span class="nt">reasonerURL</span><span class="w"> </span><span class="nv">&lt;http://jena.hpl.hp.com/2003/OWLFBRuleReasoner&gt;</span><span class="w"></span>
<span class="w">     </span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">union_graph</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w"> </span><span class="nn">tdb2:</span><span class="nt">GraphTDB</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">graphName</span><span class="w"> </span><span class="nv">&lt;urn:x-arq:UnionGraph&gt;</span><span class="w"></span>
<span class="w">  </span><span class="p">.</span><span class="w"></span>
</pre></div>


<p>Let's test this complex configuration. We will:</p>
<ol>
<li>
<p>create an <code>example-inf-multinamed</code> dataset, update its configuration file, and restart Fuseki;</p>
</li>
<li>
<p>upload the <code>data1.ttl</code> file under the <code>&lt;http://www.example.org/id/inf&gt;</code> named graph;</p>
</li>
<li>
<p>run the following <em>g-id:a</em> query (similar to the <em>id:a</em> query but including the graph):</p>
<div class="highlight"><pre><span></span><span class="k">PREFIX</span> <span class="nn">id</span><span class="p">:</span> <span class="nl">&lt;http://www.example.org/id/&gt;</span>

<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">WHERE</span> <span class="p">{</span>
  <span class="k">GRAPH</span> <span class="nv">?g</span> <span class="p">{</span>
    <span class="nn">id</span><span class="p">:</span><span class="nt">a</span> <span class="nv">?p</span> <span class="nv">?o</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">ORDER BY</span> <span class="nv">?g</span> <span class="nv">?p</span> <span class="nv">?o</span>
</pre></div>


<p>and make sure we get the following triples as a result (to verify that inference is working correctly on the <code>&lt;http://www.example.org/id/inf&gt;</code> model based on the <code>&lt;http://www.example.org/id/mygraph&gt;</code> graph):</p>
<div class="highlight"><pre><span></span>ont:myProp id:x id:inf
ont:mySuperProp id:x id:inf
rdf:type ont:MySuperType id:inf
rdf:type ont:MyType id:inf
rdf:type rdfs:Resource id:inf
rdf:type owl:Thing id:inf
owl:sameAs id:a id:inf
owl:sameAs id:b id:inf
ont:myProp id:x id:mygraph
rdf:type ont:MyType id:mygraph
</pre></div>


</li>
<li>
<p>run the <em>id:a</em> query and make sure we get the following triples as a result (to verify that the default union graph contains at least the original triples):</p>
<div class="highlight"><pre><span></span>ont:myProp id:x
rdf:type ont:MyType
rdf:type rdfs:Resource
rdf:type owl:Thing
owl:sameAs id:a
owl:sameAs id:b
</pre></div>


</li>
<li>
<p>load <code>data2.ttl</code> under the same <code>&lt;http://www.example.org/id/mygraph&gt;</code> graph and rerun both queries (to verify that no change occurs when the base named graph is updated);</p>
</li>
<li>
<p>load <code>data2.ttl</code> under <code>&lt;http://www.example.org/id/inf&gt;</code> instead, then run the <em>g-id:a</em> query and make sure we get the following triples in addition (to verify that adding triples to a model makes inference happen right away):</p>
<div class="highlight"><pre><span></span>rdf:type ont:MySubType id:inf
owl:sameAs id:d id:inf
</pre></div>


</li>
<li>
<p>run the <em>id:a</em> query and make sure that the results are the same as before (to verify that no, or limited, inference happens in the default graph without a restart);</p>
</li>
<li>
<p>restart Fuseki and run the <em>id:a</em> query again to check that all the inferred triples are present;</p>
</li>
<li>
<p>create a <code>data3.ttl</code> file with the following content, then add it to <code>&lt;http://www.example.org/id/inf2&gt;</code>:</p>
<div class="highlight"><pre><span></span><span class="k">@prefix</span><span class="w"> </span><span class="nn">rdf:</span><span class="w">  </span><span class="nv">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">rdfs:</span><span class="w"> </span><span class="nv">&lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">owl:</span><span class="w">  </span><span class="nv">&lt;http://www.w3.org/2002/07/owl#&gt;</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">id:</span><span class="w">   </span><span class="nv">&lt;http://www.example.org/id/&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">ont:</span><span class="w">  </span><span class="nv">&lt;http://www.example.org/ont#&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">ont:</span><span class="nt">MyOtherSubType</span><span class="w"> </span><span class="nn">rdfs:</span><span class="nt">subClassOf</span><span class="w"> </span><span class="nn">ont:</span><span class="nt">MyType</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="nn">id:</span><span class="nt">XXX</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w"> </span><span class="nn">ont:</span><span class="nt">MyOtherSubType</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="nn">id:</span><span class="nt">XXX</span><span class="w"> </span><span class="nn">owl:</span><span class="nt">sameAs</span><span class="w"> </span><span class="nn">id:</span><span class="nt">a</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
</pre></div>


</li>
<li>
<p>run the <em>g-id:a</em> query and make sure that the following results are included (to verify again that adding triples to a model makes inference happen right away):</p>
<div class="highlight"><pre><span></span>...
rdf:type ont:MyOtherSubType id:inf2
rdf:type ont:MyType id:inf2
rdf:type rdfs:Resource id:inf2
rdf:type owl:Thing id:inf2
owl:sameAs id:XXX id:inf2
owl:sameAs id:a id:inf2
...
</pre></div>


</li>
<li>
<p>run the <em>id:a</em> query again and make sure it gives the same results as before (to verify again that no, or limited, inference happens in the default graph without a restart);</p>
</li>
<li>
<p>restart Fuseki and run the <em>id:a</em> query again and make sure we get the following triples in addition (to verify that cross-graph inference works upon restart):</p>
<div class="highlight"><pre><span></span>...
rdf:type ont:MyOtherSubType
owl:sameAs id:XXX
...
</pre></div>


</li>
</ol>
<h3 id="adding-full-text-search">Adding full-text search</h3>
<p>After such a complex exercise on the reasoners, we may wonder whether it would be possible to add full-text search capabilities to a configuration that already includes a reasoner. The answer is: yes! The index will not include inferred triples though, but it will be useful to find some base triples to base other queries on. The configuration of a full-text index would require an article by itself, so here we will just stick to a base configuration to verify that it can work together with a reasoner.</p>
<p>We will build upon the simplest configuration that includes a reasoner, so we will start by creating a <code>example-inf-lucene</code> dataset as before, then we will update its configuration file by adding the following triples:</p>
<div class="highlight"><pre><span></span><span class="k">@prefix</span><span class="w"> </span><span class="nn">text:</span><span class="w"> </span><span class="nv">&lt;http://jena.apache.org/text#&gt;</span><span class="w"></span>
<span class="p">...</span><span class="w"></span>

<span class="nn">:</span><span class="nt">dataset</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">ja:</span><span class="nt">RDFDataset</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">ja:</span><span class="nt">defaultGraph</span><span class="w"> </span><span class="nn">:</span><span class="nt">model_inf</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">model_inf</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">ja:</span><span class="nt">InfModel</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="nn">ja:</span><span class="nt">baseModel</span><span class="w"> </span><span class="nn">:</span><span class="nt">graph</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">     </span><span class="nn">ja:</span><span class="nt">reasoner</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">         </span><span class="nn">ja:</span><span class="nt">reasonerURL</span><span class="w"> </span><span class="nv">&lt;http://jena.hpl.hp.com/2003/OWLFBRuleReasoner&gt;</span><span class="w"></span>
<span class="w">     </span><span class="p">]</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">graph</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w"> </span><span class="nn">tdb2:</span><span class="nt">GraphTDB</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="nn">tdb2:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">text_dataset</span><span class="w"> </span><span class="nn">rdf:</span><span class="nt">type</span><span class="w">     </span><span class="nn">text:</span><span class="nt">TextDataset</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">dataset</span><span class="w">   </span><span class="nn">:</span><span class="nt">dataset</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">index</span><span class="w">     </span><span class="nn">:</span><span class="nt">indexLucene</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">indexLucene</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">text:</span><span class="nt">TextIndexLucene</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">directory</span><span class="w"> </span><span class="nv">&lt;file:/etc/fuseki/databases/example-inf-lucene-index&gt;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">entityMap</span><span class="w"> </span><span class="nn">:</span><span class="nt">entMap</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">storeValues</span><span class="w"> </span><span class="l">true</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">analyzer</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">text:</span><span class="nt">StandardAnalyzer</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">queryAnalyzer</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">text:</span><span class="nt">StandardAnalyzer</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">queryParser</span><span class="w"> </span><span class="nn">text:</span><span class="nt">AnalyzingQueryParser</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">:</span><span class="nt">entMap</span><span class="w"> </span><span class="kt">a</span><span class="w"> </span><span class="nn">text:</span><span class="nt">EntityMap</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">defaultField</span><span class="w">     </span><span class="s">&quot;label&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">entityField</span><span class="w">      </span><span class="s">&quot;uri&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">uidField</span><span class="w">         </span><span class="s">&quot;uid&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">langField</span><span class="w">        </span><span class="s">&quot;lang&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">graphField</span><span class="w">       </span><span class="s">&quot;graph&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="nn">text:</span><span class="nt">map</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="nn">text:</span><span class="nt">field</span><span class="w"> </span><span class="s">&quot;label&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="nn">text:</span><span class="nt">predicate</span><span class="w"> </span><span class="nn">rdfs:</span><span class="nt">label</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="w"> </span><span class="nn">text:</span><span class="nt">field</span><span class="w"> </span><span class="s">&quot;title&quot;</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">          </span><span class="nn">text:</span><span class="nt">predicate</span><span class="w"> </span><span class="nv">&lt;http://www.example.org/ont#title&gt;</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
</pre></div>


<p>and replace this line:</p>
<div class="highlight"><pre><span></span><span class="nn">fuseki:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">tdb_dataset_readwrite</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>with the following:</p>
<div class="highlight"><pre><span></span><span class="nn">fuseki:</span><span class="nt">dataset</span><span class="w"> </span><span class="nn">:</span><span class="nt">text_dataset</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
</pre></div>


<p>This configuration wraps the dataset containing the inference model with a <code>TextDataset</code> so that a full-text index can be added; more specifically, it will let us search on the objects of the <code>rdfs:label</code> and <code>&lt;http://www.example.org/ont#title&gt;</code> predicates. The important bits to remember are:</p>
<ul>
<li>the prefix <code>&lt;http://jena.apache.org/text#&gt;</code>;</li>
<li>the <code>text:directory &lt;file:/etc/fuseki/databases/example-inf-lucene-index&gt;</code> triple (the physical location of the text index);</li>
<li>the <code>text:map</code> triples that create Lucene document fields (the values of <code>text:field</code>) associated to RDF properties (the values of <code>text:predicate</code>).</li>
</ul>
<p>Let's restart and load <code>data1.ttl</code> to this new dataset, then run the following query:</p>
<div class="highlight"><pre><span></span><span class="k">PREFIX</span> <span class="nn">ont</span><span class="p">:</span> <span class="nl">&lt;http://www.example.org/ont#&gt;</span>
<span class="k">PREFIX</span> <span class="nn">id</span><span class="p">:</span> <span class="nl">&lt;http://www.example.org/id/&gt;</span>
<span class="k">PREFIX</span> <span class="nn">text</span><span class="p">:</span> <span class="nl">&lt;http://jena.apache.org/text#&gt;</span>

<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">WHERE</span> <span class="p">{</span>
  <span class="nv">?s</span> <span class="nn">text</span><span class="p">:</span><span class="nt">query</span> <span class="p">(</span><span class="nn">ont</span><span class="p">:</span><span class="nt">title</span> <span class="s">&#39;title&#39;</span><span class="p">)</span> <span class="p">.</span>
<span class="p">}</span>
</pre></div>


<p>which will give no result as no triples with the <code>ont:title</code> predicate have been inserted. Now let's create a new file <code>data4.ttl</code> with the following content:</p>
<div class="highlight"><pre><span></span><span class="k">@prefix</span><span class="w"> </span><span class="nn">rdf:</span><span class="w">  </span><span class="nv">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">rdfs:</span><span class="w"> </span><span class="nv">&lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">owl:</span><span class="w">  </span><span class="nv">&lt;http://www.w3.org/2002/07/owl#&gt;</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">id:</span><span class="w">   </span><span class="nv">&lt;http://www.example.org/id/&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="k">@prefix</span><span class="w"> </span><span class="nn">ont:</span><span class="w">  </span><span class="nv">&lt;http://www.example.org/ont#&gt;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="nn">id:</span><span class="nt">with-label</span><span class="w"> </span><span class="nn">rdfs:</span><span class="nt">label</span><span class="w"> </span><span class="s">&quot;Usual label&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="nn">id:</span><span class="nt">with-label</span><span class="w"> </span><span class="nn">owl:</span><span class="nt">sameAs</span><span class="w"> </span><span class="nn">id:</span><span class="nt">a</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="nn">id:</span><span class="nt">with-title</span><span class="w"> </span><span class="nn">ont:</span><span class="nt">title</span><span class="w"> </span><span class="s">&quot;Meaningful title&quot;</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="nn">id:</span><span class="nt">with-title</span><span class="w"> </span><span class="nn">owl:</span><span class="nt">sameAs</span><span class="w"> </span><span class="nn">id:</span><span class="nt">a</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
</pre></div>


<p>load it, and rerun the query. Now the result will be <code>id:with-title</code>, and we can get more information if we run the following query instead:</p>
<div class="highlight"><pre><span></span><span class="k">PREFIX</span> <span class="nn">ont</span><span class="p">:</span> <span class="nl">&lt;http://www.example.org/ont#&gt;</span>
<span class="k">PREFIX</span> <span class="nn">id</span><span class="p">:</span> <span class="nl">&lt;http://www.example.org/id/&gt;</span>
<span class="k">PREFIX</span> <span class="nn">text</span><span class="p">:</span> <span class="nl">&lt;http://jena.apache.org/text#&gt;</span>

<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">WHERE</span> <span class="p">{</span>
  <span class="p">(</span><span class="nv">?s</span> <span class="nv">?score</span> <span class="nv">?title</span> <span class="nv">?graph</span> <span class="nv">?prop</span><span class="p">)</span> <span class="nn">text</span><span class="p">:</span><span class="nt">query</span> <span class="p">(</span><span class="nn">ont</span><span class="p">:</span><span class="nt">title</span> <span class="s">&#39;title&#39;</span><span class="p">)</span> <span class="p">.</span>
<span class="p">}</span>
</pre></div>


<p>which will give the following result:</p>
<div class="highlight"><pre><span></span>id:with-title &quot;0.14181954&quot;^^xsd:float &quot;Meaningful title&quot; &lt;urn:x-arq:DefaultGraphNode&gt; ont:title
</pre></div>


<p>To verify that the reasoner still works, let's run the <em>id:a</em> query again and make sure that the results include <code>rdfs:label "Usual label"</code> and <code>owl:sameAs id:with-title</code>.</p>
<h3 id="conclusions">Conclusions</h3>
<p>Automated reasoning is a complex topic, and we have seen how Jena and Fuseki are flexible enough to allow for advanced solutions. Sometimes this flexibility may come at the cost of clarity, but I am sure that, once the community starts discussing more and more use cases, simpler and cleaner solutions will come up.</p>
<h3 id="acknowledgements">Acknowledgements</h3>
<p>I'd like to thank Sascha Meckler for running through the examples and spotting some errors in this <a href="https://lists.apache.org/thread.html/ra2af0cb910c86411b9a3dc19f3329290b1f03bc9902218c880ac7143%40%3Cusers.jena.apache.org%3E">Jena users ML thread</a>.</p>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://apothem.blog/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="https://apothem.blog/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="https://apothem.blog/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>
</body>

</html>