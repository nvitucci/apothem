<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Apache Rya | APOTHEM
</title>
  <link rel="canonical" href="https://apothem.blog/apache-rya.html">


  <link rel="stylesheet" href="https://apothem.blog/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://apothem.blog/theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://apothem.blog/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://apothem.blog/theme/css/theme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://apothem.blog/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://apothem.blog/feeds/{slug}.atom.xml">  
  <meta name="description" content="Since I have been working with Semantic Web technologies for quite some time, I was looking forward to explore new Apache projects within the area. Apache Rya fit the purpose perfectly, as it is a SPARQL-enabled triplestore for Big Data, promising to scale to billions of triples across multiple nodes â€¦">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="https://apothem.blog/">
        <img class="img-fluid rounded" src=https://apothem.blog/images/profile.svg width=180 alt="APOTHEM">
      </a>
    </div>
  <div class="col-sm-8">
    <h1 class="title"><a href="https://apothem.blog/">APOTHEM</a></h1>
      <p class="text-muted">Apache Project(s) of the month</p>
      <ul class="list-inline">
          <li class="list-inline-item"><a href="https://projects.apache.org" target="_blank">projects.apache.org</a></li>
              <li class="list-inline-item text-muted">|</li>
            <li class="list-inline-item"><a href="https://apothem.blog/pages/about.html">About</a></li>
            <li class="list-inline-item"><a href="https://apothem.blog/pages/faq.html">FAQ</a></li>
            <li class=" list-inline-item text-muted">|</li>
          <li class="list-inline-item"><a class="fa fa-github" href="https://github.com/nvitucci/apothem" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fa fa-twitter" href="https://twitter.com/nvitucci" target="_blank"></a></li>
          <li class="list-inline-item"><a class="fa fa-rss" href="feeds/all.atom.xml" target="_blank"></a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Apache Rya
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2019-08-31T00:00:00+01:00">
          <i class="fa fa-clock-o"></i>
          sab 31 agosto 2019
        </li>
        <li class="list-inline-item">
          <i class="fa fa-folder-open-o"></i>
          <a href="https://apothem.blog/category/projects.html">projects</a>
        </li>
          <li class="list-inline-item">
            <i class="fa fa-files-o"></i>
              <a href="https://apothem.blog/tag/big-data.html">#Big Data</a>,               <a href="https://apothem.blog/tag/semantic-web.html">#Semantic Web</a>          </li>
      </ul>
    </header>
    <div class="content">
      <p>Since I have been working with Semantic Web technologies for quite some time, I was looking forward to explore new Apache projects within the area. <a href="https://rya.incubator.apache.org/">Apache Rya</a> fit the purpose perfectly, as it is a SPARQL-enabled triplestore for Big Data, promising to scale to billions of triples across multiple nodes. If you are completely lost after this terminology, you can take a look at the <a href="https://en.wikipedia.org/wiki/Semantic_Web">Wikipedia article</a> and the <a href="https://www.w3.org/2009/Talks/0615-SanJose-tutorial-IH/Slides.pdf">W3C presentation</a> to get an idea of the subject.</p>
<p>Rya runs on top of another Apache project, <a href="https://accumulo.apache.org/">Accumulo</a> (a distributed key/value store), and is deployed as a Web service. Since Accumulo by itself requires a fairly complex installation procedure as it is based on <a href="https://hadoop.apache.org/">Apache Hadoop</a> and <a href="https://zookeeper.apache.org/">Apache Zookeeper</a>, we will use yet another great Apache project, <a href="http://fluo.apache.org/">Apache Fluo</a> (or, more specifically, its subproject <a href="https://github.com/apache/fluo-uno">Fluo Uno</a>), to simplify the whole procedure; we will then use a well-known server, <a href="http://tomcat.apache.org/">Apache Tomcat</a>, to run it.</p>
<p>In this article we will see how to get a single-machine Rya instance up and running and how to perform basic operations; scalability, management, and more complex operations will be covered in another article. As usual, the reference operating system will be CentOS 7 (if possible, an empty/fresh instance).</p>
<h2>Preparing the environment</h2>
<h3>Installing Tomcat</h3>
<p>First of all we need to have Tomcat installed and running. On CentOS 7 it is just a matter of running the following two commands (both requiring <code>sudo</code> rights):</p>
<div class="highlight"><pre><span></span>$ sudo yum install tomcat
$ sudo service tomcat start
</pre></div>


<h3>Prerequisites for Fluo Uno</h3>
<p>In the following, we will download and use Fluo Uno to setup a single-machine Accumulo instance; its sibling project, <a href="https://github.com/apache/fluo-muchos">Fluo Muchos</a>, can be used instead to create a real cluster in Amazon's EC2.</p>
<p>In order to use Fluo Uno, we need to have Java 8, <em>wget</em>, <em>maven</em>, and <em>git</em> already installed; if any of these components is missing, it can be installed with <code>sudo yum install</code>. We also need to install the <em>shasum</em> program (<strong>not</strong> the <em>sha1sum</em> or the similar ones that are likely already installed), which is contained in the <em>perl-Digest-SHA</em> package, and we might install <em>curl</em> to test Rya's API. A quick way to install all the needed packages is to run:</p>
<div class="highlight"><pre><span></span>$ sudo yum install java wget maven git perl-Digest-SHA curl
</pre></div>


<p>Once all the components are present, we need to export the Java path. If Java has been installed under, say, <code>/usr/lib/jvm/java-1.8.0</code>, we need to run:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/lib/jvm/java-1.8.0
</pre></div>


<p>Now, in order for Hadoop to work correctly, we need to make sure we can log into localhost with SSH:</p>
<div class="highlight"><pre><span></span>$ ssh localhost
</pre></div>


<p>If this does not work, we need to create a local pair of SSH keys. First of all, let's make sure that we do not really have any SSH keys:</p>
<div class="highlight"><pre><span></span>$ ls ~/.ssh
</pre></div>


<p>If no results are returned, we can run this command:</p>
<div class="highlight"><pre><span></span>$ ssh-keygen
</pre></div>


<p>which will create a default RSA key. If, instead, some keys are already present, try to debug the error and, before running the keygen, back them up first. Once the keys are created, they need to be added to the list of authorized keys:</p>
<div class="highlight"><pre><span></span>$ cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
</pre></div>


<p>Now, <code>ssh localhost</code> should successfully open a new shell.</p>
<h3>Downloading and using Fluo Uno</h3>
<p>We are now ready to clone Fluo Uno from Github:</p>
<div class="highlight"><pre><span></span>git clone https://github.com/apache/fluo-uno.git
</pre></div>


<p>and enter the directory:</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> fluo-uno
</pre></div>


<p>Since at the time of writing Rya supports Accumulo only up to version 1.7, we need to add the next two lines at the beginning of <code>./conf/uno.conf</code> to ensure compatibility:</p>
<div class="highlight"><pre><span></span>HADOOP_VERSION=2.9.0
ACCUMULO_VERSION=1.7.3
</pre></div>


<p>After saving, we can run the following commands:</p>
<div class="highlight"><pre><span></span>$ ./bin/uno fetch accumulo
$ ./bin/uno setup accumulo
</pre></div>


<p>If everything ran successfully, we should see an output like this:</p>
<div class="highlight"><pre><span></span>Apache Hadoop 3.2.0 is running
    * NameNode status: http://localhost:9870/
    * ResourceManager status: http://localhost:8088/
    * view logs at /path/to/fluo-uno/install/logs/hadoop
Apache ZooKeeper 3.4.14 is running
    * view logs at /path/to/fluo-uno/install/logs/zookeeper
Apache Accumulo 2.0.0 is running
    * Accumulo Monitor: http://localhost:9995/
    * view logs at /path/to/fluo-uno/install/logs/accumulo
Setup complete.
</pre></div>


<p>If the output is different or some errors are displayed, try checking the <code>./install/logs</code> folder to debug.</p>
<h2>Installing Rya</h2>
<p>Once the environment is ready as detailed in the previous sections, we can clone Rya:</p>
<div class="highlight"><pre><span></span>$ git clone https://github.com/apache/incubator-rya
</pre></div>


<p>and build it:</p>
<div class="highlight"><pre><span></span>$ <span class="nb">cd</span> incubator-rya
$ mvn clean install
</pre></div>


<p>(the last command will take a while to complete because all the tests are run, which is highly recommended).</p>
<p>When Maven has finished building, we run the following command to deploy Rya on Tomcat:</p>
<div class="highlight"><pre><span></span>$ sudo cp ./web/web.rya/target/web.rya.war /var/lib/tomcat/webapps/
</pre></div>


<p>Before we can use Rya, we need to create an <code>environment.properties</code> file with the following content:</p>
<div class="highlight"><pre><span></span># Accumulo instance name
instance.name=uno
# Accumulo Zookeepers
instance.zk=localhost:2181
# Accumulo username
instance.username=root
# Accumulo password
instance.password=secret

# Rya Table Prefix
rya.tableprefix=triplestore_
# To display the query plan
rya.displayqueryplan=true
</pre></div>


<p>then assign it to the Tomcat user (usually <code>tomcat</code>), move it into the Web application classpath and restart Tomcat:</p>
<div class="highlight"><pre><span></span>$ sudo chown tomcat:tomcat environment.properties
$ sudo mv environment.properties /var/lib/tomcat/webapps/web.rya/WEB-INF/classes
$ sudo service tomcat restart
</pre></div>


<p>In order to test that Rya is deployed and configured successfully, we can run:</p>
<div class="highlight"><pre><span></span>$ curl -I <span class="s2">&quot;localhost:8080/web.rya/queryrdf&quot;</span>
</pre></div>


<p>which should give 200 as the status code. Yay, we have a running Rya instance!</p>
<h2>Examples</h2>
<p>Let's open the SPARQL endpoint on <code>http://localhost:8080/web.rya/sparqlQuery.jsp</code>. Rya's SPARQL endpoint supports SPARQL Update, so we can insert some example triples using the following query (inspired by Rya's documentation):</p>
<div class="highlight"><pre><span></span><span class="k">INSERT DATA</span>
<span class="p">{</span>
    <span class="k">GRAPH</span> <span class="nl">&lt;http://example.com/mygraph&gt;</span>
    <span class="p">{</span>
        <span class="nl">&lt;http://mynamespace/ProductType1&gt;</span> <span class="nl">&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&gt;</span> <span class="nl">&lt;http://mynamespace/ProductType&gt;</span> <span class="p">.</span>
        <span class="nl">&lt;http://mynamespace/ProductType1&gt;</span> <span class="nl">&lt;http://www.w3.org/2000/01/rdf-schema#label&gt;</span> <span class="s">&quot;Thing&quot;</span> <span class="p">.</span>
        <span class="nl">&lt;http://mynamespace/ProductType1&gt;</span> <span class="nl">&lt;http://purl.org/dc/elements/1.1/publisher&gt;</span> <span class="nl">&lt;http://mynamespace/Publisher1&gt;</span> <span class="p">.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>then retrieve them with another SPARQL query and selecting <em>JSON</em> as the result format:</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">WHERE</span>
<span class="p">{</span>
    <span class="k">GRAPH</span> <span class="nv">?g</span>
    <span class="p">{</span>
        <span class="nv">?s</span> <span class="nv">?p</span> <span class="nv">?o</span> <span class="p">.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>which should give a result similar to the following (the order of the fields might be different):</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;head&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;vars&quot;</span> <span class="p">:</span> <span class="p">[</span>
         <span class="s2">&quot;g&quot;</span><span class="p">,</span>
         <span class="s2">&quot;s&quot;</span><span class="p">,</span>
         <span class="s2">&quot;p&quot;</span><span class="p">,</span>
         <span class="s2">&quot;o&quot;</span>
      <span class="p">]</span>
   <span class="p">},</span>
   <span class="nt">&quot;results&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;bindings&quot;</span> <span class="p">:</span> <span class="p">[</span>
         <span class="p">{</span>
            <span class="nt">&quot;s&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://mynamespace/ProductType1&quot;</span><span class="p">,</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uri&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;o&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://mynamespace/Publisher1&quot;</span><span class="p">,</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uri&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;g&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uri&quot;</span><span class="p">,</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://example.com/mygraph&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;p&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uri&quot;</span><span class="p">,</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://purl.org/dc/elements/1.1/publisher&quot;</span>
            <span class="p">}</span>
         <span class="p">},</span>
         <span class="p">{</span>
            <span class="nt">&quot;o&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://mynamespace/ProductType&quot;</span><span class="p">,</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uri&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;s&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://mynamespace/ProductType1&quot;</span><span class="p">,</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uri&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;p&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&quot;</span><span class="p">,</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uri&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;g&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://example.com/mygraph&quot;</span><span class="p">,</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uri&quot;</span>
            <span class="p">}</span>
         <span class="p">},</span>
         <span class="p">{</span>
            <span class="nt">&quot;g&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uri&quot;</span><span class="p">,</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://example.com/mygraph&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;p&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://www.w3.org/2000/01/rdf-schema#label&quot;</span><span class="p">,</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uri&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;o&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;Thing&quot;</span><span class="p">,</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;literal&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;s&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uri&quot;</span><span class="p">,</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;http://mynamespace/ProductType1&quot;</span>
            <span class="p">}</span>
         <span class="p">},</span>
         <span class="p">{</span>
            <span class="nt">&quot;o&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;literal&quot;</span><span class="p">,</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;3.0.0&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;s&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;urn:org.apache.rya/2012/05#rts&quot;</span><span class="p">,</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uri&quot;</span>
            <span class="p">},</span>
            <span class="nt">&quot;p&quot;</span> <span class="p">:</span> <span class="p">{</span>
               <span class="nt">&quot;value&quot;</span> <span class="p">:</span> <span class="s2">&quot;urn:org.apache.rya/2012/05#version&quot;</span><span class="p">,</span>
               <span class="nt">&quot;type&quot;</span> <span class="p">:</span> <span class="s2">&quot;uri&quot;</span>
            <span class="p">}</span>
         <span class="p">}</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>We can get the same result using the <code>queryrdf</code> REST endpoint:</p>
<div class="highlight"><pre><span></span>$ curl <span class="s2">&quot;localhost:8080/web.rya/queryrdf&quot;</span> -d query.resultformat<span class="o">=</span>json --data-urlencode <span class="nv">query</span><span class="o">=</span><span class="s2">&quot;SELECT * WHERE {GRAPH ?g {?s ?p ?o}}&quot;</span>
</pre></div>


<h2>Conclusions</h2>
<p>Like other Apache projects still in incubation, Rya's documentation and examples may be still somewhat incomplete or difficult to follow. My aim was to try and streamline the installation process, and to provide a couple examples which allow a user to quickly see that everything is working correctly. A more complex setup and more interesting examples to come soon!</p>
    </div>
  </article>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
    <li class="list-inline-item"><a href="https://apothem.blog/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="https://apothem.blog/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="https://apothem.blog/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy" target="_blank">&#x2728;</a>
  </p>
</div>    </div>
  </footer>
</body>

</html>